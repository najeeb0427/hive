SELECT
pkey,
jobstartdate,
jobenddate,
apinumber,
statenumber,
countynumber,
operatornumber,
wellname,
latitude,
longitude,
projection,
tvd,
totalbasewatervolume,
totalbasenonwatervolume,
statename,
countyname,
ffversion,
federalwell,
indianwell,
source,
dtmod,
pkeyPurpose,
ingredientname,
CASNumber,
PercentHighAssitive,
percentHFjob,
IngredientComment,
ingredientMSDS,
MassIngredient,
Claimantcompany,
PkeyDisclosure,
Pkeyregistryupload,
tradename,
supplier,
purpose,
systemapproach,
iswater,
Proppant,
water,
Proppant_percent,
Water_percent,
Proppant_Adj,
Water_Adj,
case when (totalbasewatervolume/Water_Adj) * 8.35 > 50000000 or (totalbasewatervolume/Water_Adj) * Proppant_Adj * 8.35 < 0) then 60000000 else (totalbasewatervolume/Water_Adj) * 8.35 > 50000000 or (totalbasewatervolume/Water_Adj) * Proppant_Adj * 8.35 < 0) as Proppant_lbs,
case when length(apinumber) = 10 then concat(apinumber,"0000") when length(apinumber) = 11 then concat(apinumber,"000")  when length(apinumber) = 12 then concat(apinumber,"00")  when length(apinumber) = 13 then concat(apinumber,"0") ELSE null END AS  apinumber_FF,
case when length(apinumber) = 2 then concat(apinumber,"-") when length(apinumber) = 5 then concat(apinumber,"-")  when length(apinumber) = 10 then concat(apinumber,"-")  when length(apinumber) = 12 then concat(apinumber,"-") else null end AS  apinumber_NN
FROM
(SELECT
pkey,
jobstartdate,
jobenddate,
apinumber,
statenumber,
countynumber,
operatornumber,
wellname,
latitude,
longitude,
projection,
tvd,
totalbasewatervolume,
totalbasenonwatervolume,
statename,
countyname,
ffversion,
federalwell,
indianwell,
source,
dtmod,
pkeyPurpose,
ingredientname,
CASNumber,
PercentHighAssitive,
percentHFjob,
IngredientComment,
ingredientMSDS,
MassIngredient,
Claimantcompany,
PkeyDisclosure,
Pkeyregistryupload,
tradename,
supplier,
purpose,
systemapproach,
iswater,
Proppant,
water,
Proppant_percent,
Water_percent,
case when Proppant_percent = 0 or Proppant_percent >30 then case when Water_percent > 70 then 100-Water_percent else 0.0 end else Proppant_percent END AS  Proppant_Adj,
case when Water_percent = 0 or Water_percent >30 then case when Proppant_percent > 70 then 100-Proppant_percent else 0.0 end else Water_percent END AS  Water_Adj
FROM
(
SELECT
pkey,
jobstartdate,
jobenddate,
apinumber,
statenumber,
countynumber,
operatornumber,
wellname,
latitude,
longitude,
projection,
tvd,
totalbasewatervolume,
totalbasenonwatervolume,
statename,
countyname,
ffversion,
federalwell,
indianwell,
source,
dtmod,
pkeyPurpose,
ingerdientname,
CASNumber,
PercentHighAssitive,
percentHFjob,
IngredientComment,
ingredientMSDS,
MassIngredient,
Claimantcompany,
PkeyDisclosure,
Pkeyregistryupload,
tradename,
supplier,
purpose,
systemapproach,
iswater,
case when instr(ingredientname, 'Silica') > 0 or  instr(ingredientname, 'silica') or instr(ingredientname, 'Proppant') > 0 or  instr(ingredientname, 'proppant') > 0 then "Proppant" ELSE null END as Proppant,
case when instr(ingredientname, 'Water') > 0 or  instr(ingredientname, 'water') > 0 then "Water" ELSE null END as Water,
case when instr(ingredientname, 'Silica') > 0 or  instr(ingredientname, 'silica') or instr(ingredientname, 'Proppant') > 0 or  instr(ingredientname, 'proppant') > 0 then percentHFjob else 0.0 end as Proppant_percent,
case when instr(ingredientname, 'Water') > 0 or  instr(ingredientname, 'water') > 0  then percentHFjob else 0.0 end as Water_percent
FROM TABLENAME
) A ) B;

